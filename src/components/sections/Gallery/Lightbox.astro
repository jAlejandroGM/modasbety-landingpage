---
import { Icon } from "astro-icon/components";
---

<dialog
  id="lightbox"
  class="backdrop:bg-black/90 bg-transparent p-0 m-auto max-w-[95vw] max-h-[95vh] rounded-none outline-none overflow-hidden shadow-2xl"
>
  <div class="relative w-full h-full flex items-center justify-center">
    <img
      id="lightbox-img"
      src=""
      alt="Vista ampliada"
      class="max-w-full max-h-[90vh] object-contain"
    />
    <button
      id="close-lightbox"
      class="absolute -top-2 -right-2 md:top-0 md:right-0 text-sakura-primary hover:text-sakura-hover p-4 transition-colors z-50 focus:outline-none hover:cursor-pointer"
      aria-label="Cerrar"
    >
      <Icon name="mdi:close" class="w-8 h-8 drop-shadow-md" />
    </button>
  </div>
</dialog>

<script>
  const lightbox = document.getElementById("lightbox") as HTMLDialogElement;
  const lightboxImg = document.getElementById(
    "lightbox-img"
  ) as HTMLImageElement;
  const closeBtn = document.getElementById("close-lightbox");

  // Usamos delegación de eventos o buscamos los triggers globalmente
  // Nota: Al mover esto, asegúrate de que el script se ejecute en el cliente
  const triggers = document.querySelectorAll(".lightbox-trigger");

  if (lightbox && lightboxImg) {
    triggers.forEach((trigger) => {
      trigger.addEventListener("click", () => {
        const highResSrc = trigger.getAttribute("data-src");
        if (highResSrc) {
          lightboxImg.src = highResSrc;
          lightbox.showModal();
          document.body.style.overflow = "hidden";
        }
      });
    });

    const closeStart = () => {
      lightbox.close();
      lightboxImg.src = "";
      document.body.style.overflow = "";
    };

    closeBtn?.addEventListener("click", closeStart);
    lightbox.addEventListener("click", (event) => {
      if (event.target === lightbox) closeStart();
    });
  }
</script>

<style>
  dialog[open] {
    animation: fadeIn 0.3s ease-out forwards;
  }

  dialog::backdrop {
    animation: fadeInBackdrop 0.3s ease-out forwards;
  }

  @keyframes fadeIn {
    from {
      opacity: 0;
      transform: scale(0.95);
    }
    to {
      opacity: 1;
      transform: scale(1);
    }
  }

  @keyframes fadeInBackdrop {
    from {
      opacity: 0;
    }
    to {
      opacity: 1;
    }
  }
</style>
