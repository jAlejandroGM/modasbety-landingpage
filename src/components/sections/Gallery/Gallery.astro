---
import { Icon } from "astro-icon/components";
import { SOCIAL_LINKS, MESSAGES } from "../../../data/siteData";
import GalleryItem from "./GalleryImg.astro";
import Lightbox from "./Lightbox.astro";

const images = await Astro.glob("/src/assets/vestidos/*.{jpeg,jpg,png}");
---

<section
  id="galeria"
  class="flex flex-col items-center gap-8 lg:gap-12 max-w-[1800px] mx-auto px-4 sm:px-6"
  aria-labelledby="galeria-titulo"
>
  <div class="space-y-2">
    <h2 id="galeria-titulo">Diseños Exclusivos</h2>
    <p
      class="text-center text-sm md:text-base lg:text-xl text-balance text-gray-300 max-w-xl m-auto italic"
    >
      Algunos nuestros últimos diseños personalizados
    </p>
  </div>

  <div
    id="gallery-grid"
    class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-7 gap-3 w-3/5"
  >
    {
      images.map((img, index) => (
        <GalleryItem img={img.default} index={index} />
      ))
    }
  </div>

  <div id="gallery-controls" class="w-full flex justify-center -mt-4">
    <button
      id="btn-more"
      class="text-sm tracking-widest text-sakura-primary hover:text-sakura-hover border-b border-transparent hover:border-sakura-primary transition-all"
    >
      + Ver más
    </button>
    <button
      id="btn-less"
      class="hidden text-sm tracking-widest text-sakura-primary hover:text-sakura-hover border-b border-transparent hover:border-sakura-primary transition-all"
    >
      - Ver menos
    </button>
  </div>

  <a
    href={SOCIAL_LINKS.whatsapp(MESSAGES.whatsappDefault)}
    target="_blank"
    class="wsp-btn flex items-center gap-2 text-sm md:text-base lg:text-lg"
    rel="noopener noreferrer"
    aria-label="Solicitar información detallada por WhatsApp"
  >
    Quiero mi diseño personalizado
    <Icon
      name="mdi:whatsapp"
      class="h-6 w-6 md:h-8 md:w-8 text-inherit"
      aria-hidden="true"
    />
  </a>
</section>

<Lightbox />

<script>
  const grid = document.getElementById("gallery-grid");
  const btnMore = document.getElementById("btn-more");
  const btnLess = document.getElementById("btn-less");
  const gallerySection = document.getElementById("galeria");

  if (grid && btnMore && btnLess && gallerySection) {
    btnMore.addEventListener("click", () => {
      grid.classList.add("is-expanded");
      btnMore.classList.add("hidden");
      btnLess.classList.remove("hidden");
    });

    btnLess.addEventListener("click", () => {
      grid.classList.remove("is-expanded");
      btnMore.classList.remove("hidden");
      btnLess.classList.add("hidden");
      gallerySection.scrollIntoView({ behavior: "smooth" });
    });
  }
</script>

<style>
  /* --- 1. DEFINICIÓN DE VISIBILIDAD INICIAL (Sin Expanded) --- */

  /* Mobile: Ocultar items del 9 en adelante */
  #gallery-grid:not(.is-expanded) :global(.gallery-item:nth-child(n + 9)) {
    display: none;
  }

  /* Tablet: Mostrar items 9-12, Ocultar 13 en adelante */
  @media (min-width: 768px) {
    #gallery-grid:not(.is-expanded) :global(.gallery-item:nth-child(n + 9)) {
      display: block;
    }
    #gallery-grid:not(.is-expanded) :global(.gallery-item:nth-child(n + 13)) {
      display: none;
    }
  }

  /* Desktop: Mostrar todos y ocultar controles */
  @media (min-width: 1024px) {
    #gallery-grid:not(.is-expanded) :global(.gallery-item:nth-child(n + 13)) {
      display: block;
    }
    #gallery-controls {
      display: none;
    }
  }

  /* --- 2. LÓGICA DE EXPANSIÓN Y ANIMACIÓN --- */

  /* Cuando está expandido, forzamos mostrar todos */
  #gallery-grid.is-expanded :global(.gallery-item) {
    display: block !important;
  }

  /* Definimos la animación clásica "Reveal" */
  @keyframes revealItem {
    from {
      opacity: 0;
      transform: translateY(30px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  /* Aplicamos animación SOLO a los items nuevos que aparecen al expandir */
  #gallery-grid.is-expanded :global(.gallery-item:nth-child(n + 9)) {
    animation: revealItem 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards;
  }

  @media (min-width: 768px) {
    #gallery-grid.is-expanded :global(.gallery-item:nth-child(-n + 12)) {
      animation: none;
    }
    #gallery-grid.is-expanded :global(.gallery-item:nth-child(n + 13)) {
      animation: revealItem 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards;
    }
  }
</style>
